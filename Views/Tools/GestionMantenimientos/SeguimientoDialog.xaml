<Window x:Class="GestLog.Views.Tools.GestionMantenimientos.SeguimientoDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:enums="clr-namespace:GestLog.Modules.GestionMantenimientos.Models.Enums"
        xmlns:converters="clr-namespace:GestLog.Converters"
        Title="Registrar Mantenimiento" WindowStartupLocation="Manual"
        ResizeMode="NoResize" WindowStyle="None" AllowsTransparency="True" Background="Transparent"
        ShowInTaskbar="False" Topmost="False" UseLayoutRounding="True" SnapsToDevicePixels="True"
        Loaded="SeguimientoDialog_OnLoaded" KeyDown="SeguimientoDialog_KeyDown">
    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Views/Tools/GestionEquipos/ModalWindowsStandard.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            
            <ObjectDataProvider x:Key="TipoMantenimientoValues" MethodName="GetValues" ObjectType="{x:Type sys:Enum}" xmlns:sys="clr-namespace:System;assembly=mscorlib">
                <ObjectDataProvider.MethodParameters>
                    <x:Type TypeName="enums:TipoMantenimiento" />
                </ObjectDataProvider.MethodParameters>
            </ObjectDataProvider>
            <ObjectDataProvider x:Key="FrecuenciaMantenimientoValues" MethodName="GetValues" ObjectType="{x:Type sys:Enum}" xmlns:sys="clr-namespace:System;assembly=mscorlib">
                <ObjectDataProvider.MethodParameters>
                    <x:Type TypeName="enums:FrecuenciaMantenimiento" />
                </ObjectDataProvider.MethodParameters>
            </ObjectDataProvider>
            <CollectionViewSource x:Key="TipoMantenimientoFiltrado" Source="{Binding Source={StaticResource TipoMantenimientoValues}}" />
            <converters:InverseBooleanToVisibilityConverter x:Key="InverseBooleanToVisibilityConverter" />
            <converters:TipoMantenimientoFilterConverter x:Key="TipoMantenimientoFilterConverter" />
            <converters:DecimalToCopCurrencyConverter x:Key="DecimalToCopCurrencyConverter" />
        </ResourceDictionary>
    </Window.Resources>    <!-- Grid overlay con fondo semi-transparente -->
    <Grid x:Name="RootGrid" MouseLeftButtonDown="Overlay_MouseLeftButtonDown" Background="#80000000">        <!-- Border con la ventana modal centrada -->
        <Border Width="760" Height="Auto" MaxHeight="820" Background="{StaticResource SurfaceBrush}" CornerRadius="8" Padding="0" 
                HorizontalAlignment="Center" VerticalAlignment="Center" Margin="40" BorderThickness="1"
                BorderBrush="{StaticResource BorderBrush}" Effect="{StaticResource WindowShadow}"
                MouseLeftButtonDown="Panel_MouseLeftButtonDown">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Header con gradiente -->
                <Border Grid.Row="0" CornerRadius="8,8,0,0" Padding="24,16">
                    <Border.Background>
                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                            <GradientStop Color="#118938" Offset="0"/>
                            <GradientStop Color="#0F7530" Offset="1"/>
                        </LinearGradientBrush>
                    </Border.Background>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                            <Border Background="White" CornerRadius="6" Padding="6" Margin="0,0,12,0" Width="36" Height="36">
                                <TextBlock Text="" FontSize="16" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock Text="Registrar Mantenimiento" Style="{StaticResource HeaderTextStyle}"/>
                                <TextBlock Text="Ingresa los detalles del mantenimiento realizado" Style="{StaticResource SubHeaderTextStyle}" Margin="0,2,0,0"/>
                            </StackPanel>
                        </StackPanel>                        <Button Grid.Column="1" Style="{StaticResource CloseButton}" Click="Cancelar_Click" 
                                ToolTip="Cerrar (Esc)" Padding="6" Margin="0,-6,-6,-6" HorizontalAlignment="Right" VerticalAlignment="Center">
                            <Grid Width="14" Height="14">
                                <Line X1="0" Y1="0" X2="14" Y2="14" Stroke="White" StrokeThickness="2" StrokeStartLineCap="Round" StrokeEndLineCap="Round"/>
                                <Line X1="14" Y1="0" X2="0" Y2="14" Stroke="White" StrokeThickness="2" StrokeStartLineCap="Round" StrokeEndLineCap="Round"/>
                            </Grid>
                        </Button>
                    </Grid>
                </Border>

                <!-- Contenido principal con ScrollViewer: scrollbar autom谩tico si es necesario -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="0" Background="{StaticResource LightGrayBrush}">
                    <Border Padding="24">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>  <!-- C贸digo -->
                                <RowDefinition Height="Auto"/>  <!-- Nombre -->
                                <RowDefinition Height="Auto"/>  <!-- Fecha Realizaci贸n -->
                                <RowDefinition Height="Auto"/>  <!-- Tipo Mtto -->
                                <RowDefinition Height="Auto"/>  <!-- Responsable -->
                                <RowDefinition Height="Auto"/>  <!-- Costo -->
                                <RowDefinition Height="Auto"/>  <!-- Checklist label -->
                                <RowDefinition Height="Auto"/>  <!-- Checklist controls -->
                                <RowDefinition Height="*"/>     <!-- Descripci贸n grande -->
                                <RowDefinition Height="Auto"/>  <!-- Observaciones -->
                                <RowDefinition Height="Auto"/>  <!-- Frecuencia -->
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="160"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- Fila 0: C贸digo -->
                            <TextBlock Text="C贸digo:" Style="{StaticResource LabelTextStyle}" Grid.Row="0" Grid.Column="0" VerticalAlignment="Center" />
                            <TextBox Text="{Binding Codigo}" Grid.Row="0" Grid.Column="1" Style="{StaticResource InputStyle}" 
                                     IsReadOnly="True" IsEnabled="False" Background="#F8FAFC" Opacity="0.7"/>

                            <!-- Fila 1: Nombre -->
                            <TextBlock Text="Nombre:" Style="{StaticResource LabelTextStyle}" Grid.Row="1" Grid.Column="0"/>
                            <TextBox Text="{Binding Nombre}" Grid.Row="1" Grid.Column="1" Style="{StaticResource InputStyle}" 
                                     IsReadOnly="True" IsEnabled="False" Background="#F8FAFC" Opacity="0.7"/>

                            <!-- Fila 2: Fecha Realizaci贸n -->
                            <TextBlock Text="Fecha Realizaci贸n:" Style="{StaticResource LabelTextStyle}" Grid.Row="2" Grid.Column="0"/>
                            <DatePicker SelectedDate="{Binding FechaRealizacion, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                        Grid.Row="2" Grid.Column="1" Style="{StaticResource InputStyle}"/>

                            <!-- Fila 3: Tipo Mtto -->
                            <TextBlock Text="Tipo Mtto:" Style="{StaticResource LabelTextStyle}" Grid.Row="3" Grid.Column="0"/>
                            <ComboBox Grid.Row="3" Grid.Column="1" Style="{StaticResource InputStyle}" 
                                      SelectedItem="{Binding TipoMtno, UpdateSourceTrigger=PropertyChanged}" 
                                      ItemsSource="{Binding Source={StaticResource TipoMantenimientoFiltrado}}"/>

                            <!-- Fila 4: Responsable -->
                            <TextBlock Text="Responsable:" Style="{StaticResource LabelTextStyle}" Grid.Row="4" Grid.Column="0"/>
                            <TextBox Text="{Binding Responsable, UpdateSourceTrigger=PropertyChanged}" Grid.Row="4" Grid.Column="1" 
                                     Style="{StaticResource InputStyle}"/>

                            <!-- Fila 5: Costo -->
                            <TextBlock Text="Costo (COP):" Style="{StaticResource LabelTextStyle}" Grid.Row="5" Grid.Column="0"/>
                            <TextBox Text="{Binding Costo, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource DecimalToCopCurrencyConverter}}" Grid.Row="5" Grid.Column="1" 
                                     Style="{StaticResource InputStyle}" HorizontalContentAlignment="Right"/>

                            <!-- Fila 6: Checklist label -->
                            <TextBlock Text="Checklist:" Style="{StaticResource LabelTextStyle}" Grid.Row="6" Grid.Column="0"/>
                            <StackPanel Grid.Row="6" Grid.Column="1" Orientation="Horizontal" Margin="0,4,0,12">
                                <CheckBox x:Name="cbRevision" Content="Revisi贸n General" Margin="0,0,12,0" Checked="ChecklistItem_Checked" Unchecked="ChecklistItem_Checked"/>
                                <CheckBox x:Name="cbLimpieza" Content="Limpieza" Margin="0,0,12,0" Checked="ChecklistItem_Checked" Unchecked="ChecklistItem_Checked"/>
                                <CheckBox x:Name="cbAjustes" Content="Ajustes" Checked="ChecklistItem_Checked" Unchecked="ChecklistItem_Checked"/>
                            </StackPanel>

                            <!-- Fila 7: Descripci贸n grande -->
                            <TextBlock Text="Descripci贸n:" Style="{StaticResource LabelTextStyle}" Grid.Row="7" Grid.Column="0" VerticalAlignment="Top" Margin="0,8,8,4"/>
                            <TextBox x:Name="DescripcionTextBox" Text="{Binding Descripcion, UpdateSourceTrigger=PropertyChanged}" 
                                     Grid.Row="7" Grid.Column="1" Style="{StaticResource InputStyle}" MinHeight="140" VerticalAlignment="Top" TextWrapping="Wrap" AcceptsReturn="True"/>

                            <!-- Fila 8: Observaciones -->
                            <TextBlock Text="Observaciones:" Style="{StaticResource LabelTextStyle}" Grid.Row="8" Grid.Column="0" VerticalAlignment="Top" Margin="0,8,8,4"/>
                            <TextBox Text="{Binding Observaciones, UpdateSourceTrigger=PropertyChanged}" Grid.Row="8" Grid.Column="1" 
                                     Style="{StaticResource InputStyle}" MinHeight="50" VerticalAlignment="Top" TextWrapping="Wrap" AcceptsReturn="True"/>

                            <!-- Fila 9: Frecuencia -->
                            <TextBlock Text="Frecuencia:" Style="{StaticResource LabelTextStyle}" Grid.Row="9" Grid.Column="0" 
                                       Visibility="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=ModoRestringido, Converter={StaticResource InverseBooleanToVisibilityConverter}}"/>
                            <ComboBox Grid.Row="9" Grid.Column="1" Style="{StaticResource InputStyle}" 
                                      SelectedItem="{Binding Frecuencia, UpdateSourceTrigger=PropertyChanged}" 
                                      ItemsSource="{Binding Source={StaticResource FrecuenciaMantenimientoValues}}"
                                      Visibility="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=ModoRestringido, Converter={StaticResource InverseBooleanToVisibilityConverter}}"/>
                        </Grid>
                    </Border>
                </ScrollViewer>

                <!-- Footer con botones -->
                <Border Grid.Row="2" Padding="24" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,1,0,0" Background="{StaticResource SurfaceElevatedBrush}">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button Content="Cancelar" Style="{StaticResource GhostButton}" Click="Cancelar_Click" MinWidth="100" Margin="0,0,8,0"/>
                        <Button Content="Guardar Cambios" Style="{StaticResource PrimaryButtonStyle}" Click="Aceptar_Click" 
                                IsDefault="True" MinWidth="140"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>
    </Grid>
</Window>
