<Window x:Class="GestLog.Views.Usuarios.ChangePasswordModalView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:converters="clr-namespace:GestLog.Converters"
        mc:Ignorable="d"
        Title="Cambio de Contraseña"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        SizeToContent="Manual"
        WindowStartupLocation="CenterOwner"
        ShowInTaskbar="False"
        Width="520"
        Height="600">
      <Window.Resources>
        <converters:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        <converters:InverseBooleanToVisibilityConverter x:Key="InverseBooleanToVisibilityConverter" />
        
        <!-- Animación de rotación para spinner -->
        <Storyboard x:Key="SpinnerRotation" RepeatBehavior="Forever">
            <DoubleAnimation 
                Storyboard.TargetName="LoadingSpinner"
                Storyboard.TargetProperty="Angle"
                From="0" To="360"
                Duration="0:0:1"
                AccelerationRatio="0.1"
                DecelerationRatio="0.1" />
        </Storyboard>
    </Window.Resources><!-- Overlay -->
    <Grid x:Name="RootGrid" Background="#80000000" MouseLeftButtonDown="Overlay_MouseLeftButtonDown">
        
        <!-- Panel central (Card) -->
        <Border x:Name="Card" 
                Width="500" 
                MaxHeight="580"
                Background="White" 
                CornerRadius="8"
                Padding="0"
                HorizontalAlignment="Center" 
                VerticalAlignment="Center"
                MouseLeftButtonDown="Panel_MouseLeftButtonDown">
            
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!-- Header -->
                <Border Grid.Row="0" 
                        Background="#118938" 
                        CornerRadius="8,8,0,0" 
                        Padding="20">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <!-- Título -->
                        <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                            <Border Background="White" 
                                    CornerRadius="6" 
                                    Padding="8" 
                                    Margin="0,0,12,0"
                                    Width="40" 
                                    Height="40">
                                <TextBlock Text="🔐" FontSize="18" HorizontalAlignment="Center" VerticalAlignment="Center" />
                            </Border>
                            <StackPanel>
                                <TextBlock Text="Cambio de Contraseña Obligatorio" 
                                           FontSize="16" 
                                           FontWeight="Bold" 
                                           Foreground="White" />
                                <TextBlock Text="Por seguridad, actualice su contraseña" 
                                           FontSize="11" 
                                           Foreground="#E0E0E0" 
                                           Margin="0,4,0,0" />
                            </StackPanel>
                        </StackPanel>                        <!-- Botón Cerrar X -->
                        <Button Grid.Column="1" 
                                x:Name="BtnCerrar" 
                                Click="BtnCerrar_Click" 
                                ToolTip="Cerrar (Esc)"
                                Background="Transparent"
                                Foreground="White"
                                BorderThickness="0"
                                Padding="8"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Top"
                                Cursor="Hand">
                            <Grid Width="16" Height="16">
                                <Line X1="0" Y1="0" X2="16" Y2="16" Stroke="White" StrokeThickness="2" StrokeStartLineCap="Round" StrokeEndLineCap="Round"/>
                                <Line X1="16" Y1="0" X2="0" Y2="16" Stroke="White" StrokeThickness="2" StrokeStartLineCap="Round" StrokeEndLineCap="Round"/>
                            </Grid>
                        </Button>
                    </Grid>
                </Border>

                <!-- Cuerpo -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                    <StackPanel Orientation="Vertical" Margin="25">
                        
                        <!-- Información -->
                        <TextBlock Text="ℹ️ Seguridad de Cuenta"
                                   FontSize="12"
                                   FontWeight="SemiBold"
                                   Foreground="#118938"
                                   Margin="0,0,0,8" />
                        
                        <Border Background="#F0F7F4" 
                                CornerRadius="6"
                                Padding="12"
                                Margin="0,0,0,20">
                            <TextBlock Text="Ingrese su contraseña actual y luego establezca una nueva contraseña. Debe tener al menos 4 caracteres."
                                       FontSize="11"
                                       Foreground="#555"
                                       TextWrapping="Wrap" />
                        </Border>
                        
                        <!-- Current Password -->
                        <TextBlock Text="Contraseña Actual"
                                   FontSize="11"
                                   FontWeight="SemiBold"
                                   Foreground="#333"
                                   Margin="0,0,0,6" />
                        
                        <Border Background="#F9F9F9"
                                BorderBrush="#E0E0E0"
                                BorderThickness="1"
                                CornerRadius="4"
                                Margin="0,0,0,15">
                            <PasswordBox x:Name="CurrentPasswordBox"
                                         Padding="12,10"
                                         FontSize="12"
                                         Background="Transparent"
                                         Foreground="#333"
                                         BorderThickness="0"
                                         IsEnabled="{Binding IsNotLoading}" />
                        </Border>
                        
                        <!-- New Password -->
                        <TextBlock Text="Nueva Contraseña"
                                   FontSize="11"
                                   FontWeight="SemiBold"
                                   Foreground="#333"
                                   Margin="0,0,0,6" />
                        
                        <Border Background="#F9F9F9"
                                BorderBrush="#E0E0E0"
                                BorderThickness="1"
                                CornerRadius="4"
                                Margin="0,0,0,5">
                            <PasswordBox x:Name="NewPasswordBox"
                                         Padding="12,10"
                                         FontSize="12"
                                         Background="Transparent"
                                         Foreground="#333"
                                         BorderThickness="0"
                                         IsEnabled="{Binding IsNotLoading}" />
                        </Border>
                        
                        <TextBlock Text="• Mínimo 4 caracteres"
                                   FontSize="10"
                                   Foreground="#666"
                                   Margin="0,0,0,15" />
                        
                        <!-- Confirm Password -->
                        <TextBlock Text="Confirmar Contraseña"
                                   FontSize="11"
                                   FontWeight="SemiBold"
                                   Foreground="#333"
                                   Margin="0,0,0,6" />
                        
                        <Border Background="#F9F9F9"
                                BorderBrush="#E0E0E0"
                                BorderThickness="1"
                                CornerRadius="4"
                                Margin="0,0,0,20">
                            <PasswordBox x:Name="ConfirmPasswordBox"
                                         Padding="12,10"
                                         FontSize="12"
                                         Background="Transparent"
                                         Foreground="#333"
                                         BorderThickness="0"
                                         IsEnabled="{Binding IsNotLoading}" />
                        </Border>
                        
                        <!-- Loading Spinner -->
                        <StackPanel Orientation="Vertical"
                                    HorizontalAlignment="Center"
                                    Margin="0,20,0,0"
                                    Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
                            
                            <Grid Width="50" Height="50" HorizontalAlignment="Center" Margin="0,0,0,16">
                                <Grid.RenderTransform>
                                    <TransformGroup>
                                        <ScaleTransform ScaleX="1" ScaleY="1" CenterX="25" CenterY="25" />
                                        <RotateTransform x:Name="LoadingSpinner" Angle="0" CenterX="25" CenterY="25" />
                                    </TransformGroup>
                                </Grid.RenderTransform>
                                
                                <Ellipse Stroke="#E8E8E8" StrokeThickness="4" Fill="Transparent" 
                                         Width="50" Height="50" HorizontalAlignment="Center" VerticalAlignment="Center" />
                                <Ellipse Stroke="#118938" StrokeThickness="4" Fill="Transparent"
                                         StrokeStartLineCap="Round" StrokeEndLineCap="Round"
                                         StrokeDashArray="15,40"
                                         Width="50" Height="50" HorizontalAlignment="Center" VerticalAlignment="Center" />
                            </Grid>
                            
                            <TextBlock Text="Cambiando contraseña..."
                                       FontSize="12"
                                       Foreground="#118938"
                                       HorizontalAlignment="Center"
                                       FontWeight="SemiBold" />
                        </StackPanel>
                        
                        <!-- Error Message -->
                        <Border Background="#FFE5E5" 
                                CornerRadius="4"
                                Padding="12"
                                Margin="0,0,0,12"
                                Visibility="{Binding ShowError, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="❌ " FontSize="12" Foreground="#DC3545" Margin="0,0,8,0" />
                                <TextBlock Text="{Binding ErrorMessage}"
                                           FontSize="11"
                                           Foreground="#DC3545"
                                           TextWrapping="Wrap"
                                           VerticalAlignment="Center" />
                            </StackPanel>
                        </Border>
                        
                        <!-- Success Message -->
                        <Border Background="#D4EDDA" 
                                CornerRadius="4"
                                Padding="16"
                                Margin="0,0,0,12"
                                Visibility="{Binding ShowSuccess, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <StackPanel Orientation="Vertical">
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                    <TextBlock Text="✅" FontSize="20" Foreground="#28A745" Margin="0,0,12,0" VerticalAlignment="Center" />
                                    <TextBlock Text="¡Contraseña actualizada!"
                                               FontSize="13"
                                               FontWeight="Bold"
                                               Foreground="#155724"
                                               VerticalAlignment="Center" />
                                </StackPanel>
                                <TextBlock Text="{Binding SuccessMessage}"
                                           FontSize="12"
                                           Foreground="#155724"
                                           TextWrapping="Wrap"
                                           Margin="32,0,0,0"
                                           LineHeight="20" />
                            </StackPanel>
                        </Border>
                        
                    </StackPanel>
                </ScrollViewer>

                <!-- Footer -->
                <Border Grid.Row="2" 
                        Padding="20,12" 
                        Background="Transparent"
                        BorderThickness="0,1,0,0"
                        BorderBrush="#F0F0F0">                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button Content="Cancelar"
                                Padding="16,8"
                                FontSize="11"
                                Foreground="#666"
                                Background="Transparent"
                                BorderBrush="#DDD"
                                BorderThickness="1"
                                Command="{Binding CancelCommand}"
                                Cursor="Hand"
                                IsEnabled="{Binding IsNotLoading}"
                                Margin="0,0,10,0" />
                        
                        <Button Content="Cambiar Contraseña"
                                Padding="16,8"
                                FontSize="11"
                                FontWeight="SemiBold"
                                Foreground="White"
                                Background="#118938"
                                BorderThickness="0"
                                Command="{Binding ChangePasswordCommand}"
                                Cursor="Hand"
                                IsEnabled="{Binding IsNotLoading}" />
                    </StackPanel>
                </Border>
            </Grid>
        </Border>
    </Grid>
</Window>
