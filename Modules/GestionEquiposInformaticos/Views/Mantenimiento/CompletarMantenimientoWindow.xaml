<Window x:Class="GestLog.Modules.GestionEquiposInformaticos.Views.Mantenimiento.CompletarMantenimientoWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:conv="clr-namespace:GestLog.Converters"
        mc:Ignorable="d"
        Title="Completar Mantenimiento"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        SizeToContent="Manual"
        WindowStartupLocation="CenterOwner"
        ShowInTaskbar="False"
        UseLayoutRounding="True"
        SnapsToDevicePixels="True"
        d:DesignHeight="420" d:DesignWidth="650">

    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Modules/GestionEquiposInformaticos/Views/Equipos/ModalWindowsStandard.xaml" />
            </ResourceDictionary.MergedDictionaries>
            <conv:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
            <conv:InverseBooleanConverter x:Key="InverseBooleanConverter" />
            <conv:NullToVisibilityConverter x:Key="NullToVisibilityConverter" />

            <Style x:Key="RoundedButton" TargetType="Button">
                <Setter Property="MinHeight" Value="36" />
                <Setter Property="Padding" Value="10,6" />
                <Setter Property="BorderThickness" Value="0" />
                <Setter Property="Background" Value="{StaticResource PrimaryBrush}" />
                <Setter Property="Foreground" Value="White" />
                <Setter Property="FontWeight" Value="SemiBold" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Border Background="{TemplateBinding Background}" CornerRadius="8" SnapsToDevicePixels="True">
                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <Style x:Key="CancelButton" TargetType="Button" BasedOn="{StaticResource RoundedButton}">
                <Setter Property="Background" Value="#E0E0E0" />
                <Setter Property="Foreground" Value="#333333" />
            </Style>
        </ResourceDictionary>
    </Window.Resources>

    <Grid x:Name="RootGrid" Background="#80000000" MouseLeftButtonDown="Overlay_MouseLeftButtonDown">
        <Border x:Name="Card" Width="650" MaxHeight="450"
                Background="{StaticResource SurfaceBrush}"
                CornerRadius="8" Padding="0"
                HorizontalAlignment="Center" VerticalAlignment="Center"
                BorderThickness="1" BorderBrush="{StaticResource BorderBrush}"
                Effect="{StaticResource WindowShadow}" MouseLeftButtonDown="Panel_MouseLeftButtonDown">

            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <Border Grid.Row="0" Background="{StaticResource PrimaryBrush}" CornerRadius="8,8,0,0" Padding="24,16">
                    <DockPanel>
                        <StackPanel DockPanel.Dock="Left" Orientation="Horizontal" VerticalAlignment="Center">
                            <Border Background="White" CornerRadius="6" Padding="6" Margin="0,0,16,0" Width="36" Height="36">
                                <TextBlock Text="✅" FontSize="16" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock Text="Completar Mantenimiento" Style="{StaticResource HeaderTextStyle}"/>
                                <TextBlock Text="Registrar costo final y observaciones" Style="{StaticResource SubHeaderTextStyle}" Margin="0,3,0,0"/>
                            </StackPanel>
                        </StackPanel>
                    </DockPanel>
                </Border>

                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="24,20" Background="{StaticResource LightGrayBrush}">
                    <StackPanel Orientation="Vertical" Width="580">
                        <TextBlock Text="Mantenimiento" FontWeight="SemiBold" Margin="0,0,0,6" Foreground="#333333"/>
                        <TextBlock Text="{Binding Mantenimiento.Codigo}" Padding="10,8" Margin="0,0,0,16" MinHeight="36" Background="#F5F5F5" Foreground="#666666" VerticalAlignment="Center" TextWrapping="Wrap"/>

                        <TextBlock Text="Proveedor Asignado" FontWeight="SemiBold" Margin="0,0,0,6" Foreground="#333333"/>
                        <TextBlock Text="{Binding Mantenimiento.ProveedorAsignado}" Padding="10,8" Margin="0,0,0,16" MinHeight="36" Background="#F5F5F5" Foreground="#666666" VerticalAlignment="Center" TextWrapping="Wrap"/>                        <TextBlock Text="Costo de Reparación (Opcional)" FontWeight="SemiBold" Margin="0,0,0,6" Foreground="#333333"/>
                        <TextBox x:Name="CostoTextBox" Text="{Binding CostoReparacion, UpdateSourceTrigger=PropertyChanged}" Padding="10,8" Margin="0,0,0,16" MinHeight="36" Background="White" BorderBrush="{StaticResource BorderBrush}" BorderThickness="1" ToolTip="Ingrese el costo total" PreviewTextInput="CostoTextBox_PreviewTextInput"/>

                        <TextBlock Text="Período de Garantía en Días (Opcional)" FontWeight="SemiBold" Margin="0,0,0,6" Foreground="#333333"/>
                        <TextBox x:Name="GarantiaTextBox" Text="{Binding PeriodoGarantia, UpdateSourceTrigger=PropertyChanged}" Padding="10,8" Margin="0,0,0,16" MinHeight="36" Background="White" BorderBrush="{StaticResource BorderBrush}" BorderThickness="1" ToolTip="Ej: 90, 180, 365 días" PreviewTextInput="GarantiaTextBox_PreviewTextInput"/>

                        <TextBlock Text="Historial de Observaciones" FontWeight="SemiBold" Margin="0,0,0,6" Foreground="#333333"/>
                        <TextBlock Text="{Binding Mantenimiento.Observaciones}" Padding="10,8" Margin="0,0,0,16" MinHeight="60" Background="#F5F5F5" Foreground="#666666" VerticalAlignment="Top" TextWrapping="Wrap" FontFamily="Courier New" FontSize="11"/>                        <TextBlock Text="Agregar Observación (Opcional)" FontWeight="SemiBold" Margin="0,0,0,6" Foreground="#333333"/>
                        <TextBox x:Name="ObservacionesTextBox" Text="{Binding Observaciones, UpdateSourceTrigger=PropertyChanged}" Padding="10,8" Margin="0,0,0,16" MinHeight="60" TextWrapping="Wrap" VerticalScrollBarVisibility="Auto" Background="White" BorderBrush="{StaticResource BorderBrush}" BorderThickness="1" ToolTip="Nueva observación a agregar al historial"/>

                        <Border Padding="12,10" Background="#FFF3CD" BorderBrush="#FFC107" BorderThickness="1" CornerRadius="6" Margin="0,0,0,16">
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                <CheckBox x:Name="DarDeBajaCheckBox" IsChecked="{Binding IncluirDarDeBaja, UpdateSourceTrigger=PropertyChanged}" VerticalAlignment="Center" Margin="0,0,12,0"/>
                                <TextBlock Text="⚠️ El equipo/periférico NO es reparable. Dar de baja en lugar de completar reparación." TextWrapping="Wrap" VerticalAlignment="Center" Foreground="#856404" FontSize="12"/>
                            </StackPanel>
                        </Border>

                        <TextBlock Text="{Binding ErrorMessage}" Foreground="#C0392B" TextWrapping="Wrap" Margin="0,0,0,12" Visibility="{Binding ErrorMessage, Converter={StaticResource NullToVisibilityConverter}}"/>
                    </StackPanel>
                </ScrollViewer>                <Border Grid.Row="2" Background="#FAFAFA" CornerRadius="0,0,8,8" Padding="24,16" BorderThickness="0,1,0,0" BorderBrush="{StaticResource BorderBrush}">
                    <DockPanel>
                        <Button x:Name="CancelarButton" DockPanel.Dock="Right" Content="Cancelar" Click="CancelarButton_Click" Style="{StaticResource CancelButton}" MinWidth="100" Margin="12,0,0,0"/>
                        <Button x:Name="DarDeBajaButton" DockPanel.Dock="Right" Content="Dar de Baja" Command="{Binding CompletarYDarDeBajaCommand}" Style="{StaticResource RoundedButton}" MinWidth="140" Margin="12,0,0,0" Background="#DC3545" Visibility="{Binding IncluirDarDeBaja, Converter={StaticResource BooleanToVisibilityConverter}}" IsEnabled="{Binding IsLoading, Converter={StaticResource InverseBooleanConverter}}"/>
                        <Button x:Name="CompletarButton" DockPanel.Dock="Right" Content="Completar" Command="{Binding CompletarMantenimientoCommand}" Style="{StaticResource RoundedButton}" MinWidth="140" Visibility="{Binding IncluirDarDeBaja, Converter={StaticResource InverseBooleanConverter}}" IsEnabled="{Binding IsLoading, Converter={StaticResource InverseBooleanConverter}}"/>
                        <StackPanel DockPanel.Dock="Left" Orientation="Horizontal" VerticalAlignment="Center" Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <TextBlock Text="Procesando..." Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,12,0" VerticalAlignment="Center"/>
                        </StackPanel>
                    </DockPanel>
                </Border>
            </Grid>
        </Border>
    </Grid>
</Window>
