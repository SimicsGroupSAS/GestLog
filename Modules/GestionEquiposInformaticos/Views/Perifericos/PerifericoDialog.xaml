<Window x:Class="GestLog.Modules.GestionEquiposInformaticos.Views.Perifericos.PerifericoDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:conv="clr-namespace:GestLog.Converters"
        mc:Ignorable="d"
        Title="{Binding TituloDialog}" 
        Height="700" Width="900"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        SizeToContent="Manual"
        WindowStartupLocation="Manual"
        ShowInTaskbar="False"
        UseLayoutRounding="True"
        SnapsToDevicePixels="True"
        TextOptions.TextFormattingMode="Display"
        TextOptions.TextRenderingMode="ClearType"
        TextOptions.TextHintingMode="Fixed"
        RenderOptions.BitmapScalingMode="HighQuality"
        RenderOptions.ClearTypeHint="Enabled">
    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Modules/GestionEquiposInformaticos/Views/Equipos/ModalWindowsStandard.xaml" />
            </ResourceDictionary.MergedDictionaries>

            <conv:EnumToDescriptionConverter x:Key="EnumToDescriptionConverter"/>
            <conv:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
            <conv:InverseBooleanConverter x:Key="InverseBooleanConverter" />
            <conv:InverseBooleanToVisibilityConverter x:Key="InverseBooleanToVisibilityConverter" />
        </ResourceDictionary>
    </Window.Resources>    <Grid x:Name="RootGrid" Background="#80000000" MouseLeftButtonDown="Overlay_MouseLeftButtonDown" UseLayoutRounding="True" SnapsToDevicePixels="True">
        <!-- Panel centrado modal -->
        <Border x:Name="Card" Width="900" MaxHeight="700" Background="{StaticResource SurfaceBrush}" CornerRadius="12" Padding="0"
                HorizontalAlignment="Center" VerticalAlignment="Center" Effect="{StaticResource WindowShadow}" MouseLeftButtonDown="Panel_MouseLeftButtonDown"
                UseLayoutRounding="True" SnapsToDevicePixels="True" RenderOptions.BitmapScalingMode="HighQuality">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>                <!-- Header Modal -->
                <Border Grid.Row="0" Background="{StaticResource PrimaryBrush}" CornerRadius="12,12,0,0" Padding="24,16" Effect="{StaticResource HeaderShadow}" UseLayoutRounding="True" SnapsToDevicePixels="True">
                    <Grid UseLayoutRounding="True" SnapsToDevicePixels="True">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                            <Border Background="White" 
                                    CornerRadius="8" 
                                    Padding="8" 
                                    Margin="0,0,12,0"
                                    Width="42" 
                                    Height="42"
                                    Effect="{StaticResource SectionShadow}"
                                    UseLayoutRounding="True"
                                    SnapsToDevicePixels="True">
                                <!-- Icono de perif茅rico -->
                                <TextBlock Text="" FontSize="18" Foreground="{StaticResource PrimaryBrush}" HorizontalAlignment="Center" VerticalAlignment="Center" TextAlignment="Center"/>
                            </Border>
                            <StackPanel>
                                <TextBlock Text="{Binding TituloDialog}" Style="{StaticResource HeaderTextStyle}" Foreground="White"/>
                                <TextBlock Text="Gestiona informaci贸n detallada del perif茅rico" Style="{StaticResource SubHeaderTextStyle}" Foreground="White"/>
                            </StackPanel>
                        </StackPanel>

                        <Button Grid.Column="1" x:Name="BtnCerrarHeader" Style="{StaticResource CloseButton}" Click="BtnCerrar_Click" ToolTip="Cerrar (Esc)" HorizontalAlignment="Right" VerticalAlignment="Center" Padding="6">
                            <Grid Width="14" Height="14">
                                <Line X1="0" Y1="0" X2="14" Y2="14" Stroke="White" StrokeThickness="2" StrokeStartLineCap="Round" StrokeEndLineCap="Round"/>
                                <Line X1="14" Y1="0" X2="0" Y2="14" Stroke="White" StrokeThickness="2" StrokeStartLineCap="Round" StrokeEndLineCap="Round"/>
                            </Grid>
                        </Button>
                    </Grid>
                </Border>                <!-- Contenido -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="24" UseLayoutRounding="True" SnapsToDevicePixels="True">
                    <StackPanel UseLayoutRounding="True" SnapsToDevicePixels="True">
                        <!-- Secci贸n: Informaci贸n B谩sica -->
                        <Border Background="{StaticResource SurfaceBrush}" 
                                CornerRadius="8" 
                                BorderBrush="{StaticResource BorderBrush}" 
                                BorderThickness="1"
                                Effect="{StaticResource CardShadow}"
                                Padding="24">
                            <StackPanel>
                                <TextBlock Text=" Informaci贸n B谩sica" Style="{StaticResource SectionHeaderStyle}"/>
                                
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="16"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    
                                    <!-- Fila 1: C贸digo y Dispositivo -->
                                    <StackPanel Grid.Row="0" Grid.Column="0">
                                        <TextBlock Text="C贸digo *" Style="{StaticResource LabelTextStyle}"/>
                                        <TextBox x:Name="TxtCodigo" 
                                                 Text="{Binding PerifericoActual.Codigo, UpdateSourceTrigger=PropertyChanged}"
                                                 Style="{StaticResource InputStyle}" 
                                                 IsReadOnly="{Binding IsReadOnlyMode}"/>
                                    </StackPanel>
                                    <StackPanel Grid.Row="0" Grid.Column="2">
                                        <TextBlock Text="Dispositivo *" Style="{StaticResource LabelTextStyle}"/>
                                        <ComboBox x:Name="CmbDispositivo" 
                                                  Text="{Binding FiltroDispositivo, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                  ItemsSource="{Binding DispositivosFiltrados}"
                                                  IsEditable="True"
                                                  IsTextSearchEnabled="False"
                                                  Style="{StaticResource InputStyle}"
                                                  IsEnabled="{Binding IsReadOnlyMode, Converter={StaticResource InverseBooleanConverter}}"/>
                                    </StackPanel>
                                    
                                    <!-- Fila 2: Marca y Modelo -->
                                    <StackPanel Grid.Row="1" Grid.Column="0">
                                        <TextBlock Text="Marca" Style="{StaticResource LabelTextStyle}"/>
                                        <ComboBox x:Name="CmbMarca" 
                                                  Text="{Binding FiltroMarca, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                  ItemsSource="{Binding MarcasFiltradas}"
                                                  IsEditable="True"
                                                  IsTextSearchEnabled="False"
                                                  Style="{StaticResource InputStyle}"
                                                  IsEnabled="{Binding IsReadOnlyMode, Converter={StaticResource InverseBooleanConverter}}"/>
                                    </StackPanel>
                                    
                                    <StackPanel Grid.Row="1" Grid.Column="2">
                                        <TextBlock Text="Modelo" Style="{StaticResource LabelTextStyle}"/>
                                        <TextBox x:Name="TxtModelo" 
                                                 Text="{Binding PerifericoActual.Modelo, UpdateSourceTrigger=PropertyChanged}"
                                                 Style="{StaticResource InputStyle}"
                                                 IsReadOnly="{Binding IsReadOnlyMode}"/>
                                    </StackPanel>
                                    
                                    <!-- Fila 3: Serial (span completo) -->
                                    <StackPanel Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="3">
                                        <TextBlock Text="N煤mero de Serie" Style="{StaticResource LabelTextStyle}"/>
                                        <TextBox x:Name="TxtSerial" 
                                                 Text="{Binding PerifericoActual.Serial, UpdateSourceTrigger=PropertyChanged}"
                                                 Style="{StaticResource InputStyle}"
                                                 IsReadOnly="{Binding IsReadOnlyMode}"/>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!-- Secci贸n: Informaci贸n Financiera -->
                        <Border Background="{StaticResource SurfaceBrush}" 
                                CornerRadius="8" 
                                BorderBrush="{StaticResource BorderBrush}" 
                                BorderThickness="1"
                                Effect="{StaticResource CardShadow}"
                                Padding="24"
                                Margin="0,20,0,0">
                            <StackPanel>
                                <TextBlock Text=" Informaci贸n Financiera" Style="{StaticResource SectionHeaderStyle}"/>
                                
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="16"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <StackPanel Grid.Column="0">
                                        <TextBlock Text="Fecha de Compra" Style="{StaticResource LabelTextStyle}"/>
                                        <DatePicker x:Name="DpFechaCompra" 
                                                    SelectedDate="{Binding PerifericoActual.FechaCompra, UpdateSourceTrigger=PropertyChanged}"
                                                    Style="{StaticResource InputStyle}"
                                                    IsEnabled="{Binding IsReadOnlyMode, Converter={StaticResource InverseBooleanConverter}}"/>
                                    </StackPanel>
                                    
                                    <StackPanel Grid.Column="2">
                                        <TextBlock Text="Costo (COP)" Style="{StaticResource LabelTextStyle}"/>
                                        <TextBox x:Name="TxtCosto" 
                                                 Text="{Binding PerifericoActual.Costo, UpdateSourceTrigger=PropertyChanged, StringFormat=N0}"
                                                 Style="{StaticResource InputStyle}"
                                                 IsReadOnly="{Binding IsReadOnlyMode}"/>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!-- Secci贸n: Ubicaci贸n y Estado -->
                        <Border Background="{StaticResource SurfaceBrush}" 
                                CornerRadius="8" 
                                BorderBrush="{StaticResource BorderBrush}" 
                                BorderThickness="1"
                                Effect="{StaticResource CardShadow}"
                                Padding="24"
                                Margin="0,20,0,0">
                            <StackPanel>
                                <TextBlock Text=" Ubicaci贸n y Estado" Style="{StaticResource SectionHeaderStyle}"/>
                                
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="16"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    
                                    <!-- Fila 1: Sede y Estado -->
                                    <StackPanel Grid.Row="0" Grid.Column="0">
                                        <TextBlock Text="Sede *" Style="{StaticResource LabelTextStyle}"/>
                                        <ComboBox x:Name="CmbSede" 
                                                  ItemsSource="{Binding SedesDisponibles}"
                                                  SelectedItem="{Binding PerifericoActual.Sede, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                                                  Style="{StaticResource InputStyle}"
                                                  IsEnabled="{Binding IsReadOnlyMode, Converter={StaticResource InverseBooleanConverter}}">
                                            <ComboBox.ItemTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding Converter={StaticResource EnumToDescriptionConverter}}"/>
                                                </DataTemplate>
                                            </ComboBox.ItemTemplate>
                                        </ComboBox>
                                    </StackPanel>
                                    <StackPanel Grid.Row="0" Grid.Column="2">
                                        <TextBlock Text="Estado *" Style="{StaticResource LabelTextStyle}"/>
                                        <ComboBox x:Name="CmbEstado" 
                                                  ItemsSource="{Binding EstadosDisponibles}"
                                                  SelectedItem="{Binding PerifericoActual.Estado, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                                                  Style="{StaticResource InputStyle}"
                                                  IsEnabled="{Binding IsReadOnlyMode, Converter={StaticResource InverseBooleanConverter}}">
                                            <ComboBox.ItemTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding Converter={StaticResource EnumToDescriptionConverter}}"/>
                                                </DataTemplate>
                                            </ComboBox.ItemTemplate>
                                        </ComboBox>
                                    </StackPanel>
                                    
                                    <!-- Fila 2: Usuario Asignado (span completo) -->
                                    <StackPanel Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="3">
                                        <TextBlock Text="Usuario Asignado" Style="{StaticResource LabelTextStyle}"/>
                                        <ComboBox x:Name="CmbUsuarioAsignado"
                                                  Height="40"
                                                  IsEditable="True"
                                                  ItemsSource="{Binding PersonasConEquipoFiltradas}"
                                                  SelectedItem="{Binding PersonaConEquipoSeleccionada, Mode=TwoWay}"
                                                  Text="{Binding FiltroUsuarioAsignado, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                  DisplayMemberPath="DisplayText"
                                                  IsTextSearchEnabled="False"
                                                  Style="{StaticResource InputStyle}"
                                                  Background="{StaticResource SurfaceBrush}"
                                                  BorderBrush="{StaticResource BorderBrush}"
                                                  ToolTip="Buscar y seleccionar usuario con equipo asignado. Formato: Nombre Completo (C贸digo Equipo)"
                                                  IsEnabled="{Binding IsReadOnlyMode, Converter={StaticResource InverseBooleanConverter}}"/>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!-- Secci贸n: Observaciones -->
                        <Border Background="{StaticResource SurfaceBrush}" 
                                CornerRadius="8" 
                                BorderBrush="{StaticResource BorderBrush}" 
                                BorderThickness="1"
                                Effect="{StaticResource CardShadow}"
                                Padding="24"
                                Margin="0,20,0,0">
                            <StackPanel>
                                <TextBlock Text=" Observaciones Adicionales" Style="{StaticResource SectionHeaderStyle}"/>
                                
                                <TextBox x:Name="TxtObservaciones" 
                                         Text="{Binding PerifericoActual.Observaciones, UpdateSourceTrigger=PropertyChanged}"
                                         TextWrapping="Wrap"
                                         AcceptsReturn="True"
                                         Height="100"
                                         VerticalContentAlignment="Top"
                                         VerticalScrollBarVisibility="Auto"
                                         Style="{StaticResource InputStyle}"
                                         Margin="0,0,0,0"
                                         ToolTip="Ingrese cualquier informaci贸n adicional relevante sobre el perif茅rico"
                                         IsReadOnly="{Binding IsReadOnlyMode}"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>

                <!-- Footer Modal -->
                <Border Grid.Row="2" Padding="24,12" Background="Transparent" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,1,0,0">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
                        <Button Content="Eliminar" 
                                Command="{Binding EliminarCommand}"
                                Visibility="{Binding ShowDeleteButton, Converter={StaticResource BooleanToVisibilityConverter}}"
                                Style="{StaticResource DangerButtonStyle}"
                                Margin="0,0,8,0"/>
                        
                        <!-- Editar: visible solo en modo solo lectura -->
                        <Button Content="Editar"
                                Command="{Binding EditarCommand}"
                                Visibility="{Binding IsReadOnlyMode, Converter={StaticResource BooleanToVisibilityConverter}}"
                                Style="{StaticResource GhostButton}"
                                Margin="0,0,8,0"/>
                        
                        <Button Content="Cancelar" 
                                Style="{StaticResource GhostButton}"
                                Click="BtnCerrar_Click"
                                Margin="0,0,8,0"/>
                        
                        <Button x:Name="BtnGuardar"
                                Command="{Binding GuardarCommand}"
                                IsDefault="True"
                                Style="{StaticResource PrimaryButtonStyle}"
                                Visibility="{Binding IsReadOnlyMode, Converter={StaticResource InverseBooleanToVisibilityConverter}}">
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                <TextBlock Text="" FontSize="14" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding TextoBotonPrincipal}" FontWeight="SemiBold" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>
    </Grid>
</Window>
