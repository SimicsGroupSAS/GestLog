<Window x:Class="GestLog.Modules.GestionEquiposInformaticos.Views.Perifericos.PerifericoDetalleView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:GestLog.Modules.GestionEquiposInformaticos.Views.Perifericos"
        xmlns:converters="clr-namespace:GestLog.Converters"
        Title="Detalle Periférico"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        SizeToContent="Manual"
        WindowStartupLocation="CenterOwner"
        ShowInTaskbar="False">

    <Window.Resources>
        <!-- Referencia al diccionario estándar de modales -->
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Modules/GestionEquiposInformaticos/Views/Equipos/ModalWindowsStandard.xaml" />
            </ResourceDictionary.MergedDictionaries>

            <!-- Conversor local necesario para bindings de Visibility -->
            <converters:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
            <!-- Converter para mapear estado a color de fondo en el badge -->
            <converters:EstadoToColorConverter x:Key="EstadoToColorConverter" />
        </ResourceDictionary>
    </Window.Resources>

    <Grid x:Name="RootGrid" Background="#80000000" MouseLeftButtonDown="Overlay_MouseLeftButtonDown">
        <!-- Panel centrado -->
        <Border x:Name="Card" Width="640" MaxHeight="640" Background="{StaticResource SurfaceBrush}" CornerRadius="8" Padding="0"
                HorizontalAlignment="Center" VerticalAlignment="Center" Effect="{StaticResource WindowShadow}" MouseLeftButtonDown="Panel_MouseLeftButtonDown">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!-- Header -->
                <Border Grid.Row="0" Background="{StaticResource PrimaryBrush}" CornerRadius="8,8,0,0" Padding="16" Effect="{StaticResource HeaderShadow}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                            <Border Background="White" 
                                    CornerRadius="6" 
                                    Padding="6" 
                                    Margin="0,0,12,0"
                                    Width="36" 
                                    Height="36"
                                    Effect="{StaticResource SectionShadow}"
                                    UseLayoutRounding="True"
                                    SnapsToDevicePixels="True">
                                <!-- Icono de periférico: teclado (U+2328) para representarlo de forma genérica -->
                                <TextBlock Text="⌨" FontSize="16" Foreground="{StaticResource PrimaryBrush}" HorizontalAlignment="Center" VerticalAlignment="Center" TextAlignment="Center"/>
                            </Border>
                            <StackPanel>
                                <TextBlock Text="Detalle de Periférico" Style="{StaticResource HeaderTextStyle}" Foreground="White"/>
                                <TextBlock Text="Información detallada" Style="{StaticResource SubHeaderTextStyle}" Foreground="White"/>
                            </StackPanel>
                        </StackPanel>

                        <Button Grid.Column="1" x:Name="BtnCerrar" Style="{StaticResource CloseButton}" Click="BtnCerrar_Click" ToolTip="Cerrar (Esc)" HorizontalAlignment="Right" VerticalAlignment="Center">
                            <Grid Width="14" Height="14">
                                <Line X1="0" Y1="0" X2="14" Y2="14" Stroke="White" StrokeThickness="2" StrokeStartLineCap="Round" StrokeEndLineCap="Round"/>
                                <Line X1="14" Y1="0" X2="0" Y2="14" Stroke="White" StrokeThickness="2" StrokeStartLineCap="Round" StrokeEndLineCap="Round"/>
                            </Grid>
                        </Button>
                    </Grid>
                </Border>

                <!-- Cuerpo -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="20" Orientation="Vertical">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" Orientation="Vertical">
                                <TextBlock Text="Código" Style="{StaticResource LabelTextStyle}" Margin="0,0,0,8"/>
                                <TextBlock Text="{Binding Codigo}" Style="{StaticResource ValueTextStyle}" Margin="0,0,0,8"/>

                                <TextBlock Text="Dispositivo" Style="{StaticResource LabelTextStyle}" Margin="0,8,0,8"/>
                                <TextBlock Text="{Binding Nombre}" Style="{StaticResource ValueTextStyle}" TextWrapping="Wrap" Margin="0,0,0,8"/>

                                <TextBlock Text="Sede" Style="{StaticResource LabelTextStyle}" Margin="0,12,0,8" />
                                <TextBlock Text="{Binding Sede}" Style="{StaticResource ValueTextStyle}" Margin="0,0,0,8"/>

                                <TextBlock Text="Asignación" Style="{StaticResource LabelTextStyle}" Margin="0,12,0,8" />
                                <TextBlock Text="{Binding Asignacion}" Style="{StaticResource ValueTextStyle}" Margin="0,0,0,8"/>

                                <TextBlock Text="Estado" Style="{StaticResource LabelTextStyle}" Margin="0,12,0,0" />
                                <!-- Usar StatusBadge si aplica -->
                                <Border Style="{StaticResource StatusBadge}" Background="{Binding Estado, Converter={StaticResource EstadoToColorConverter}}">
                                    <TextBlock Text="{Binding Estado}" Style="{StaticResource StatusText}"/>
                                </Border>
                            </StackPanel>

                            <StackPanel Grid.Column="1" Orientation="Vertical" Margin="16,0,0,0">
                                <TextBlock Text="Marca" Style="{StaticResource LabelTextStyle}" Margin="0,0,0,8"/>
                                <TextBlock Text="{Binding Marca}" Style="{StaticResource ValueTextStyle}" Margin="0,0,0,8"/>

                                <TextBlock Text="Modelo" Style="{StaticResource LabelTextStyle}" Margin="0,12,0,8" />
                                <TextBlock Text="{Binding Modelo}" Style="{StaticResource ValueTextStyle}" Margin="0,0,0,8"/>

                                <TextBlock Text="Número de serie" Style="{StaticResource LabelTextStyle}" Margin="0,12,0,8" />
                                <TextBlock Text="{Binding SerialNumber}" Style="{StaticResource ValueTextStyle}" Margin="0,0,0,8"/>

                                <TextBlock Text="Fecha adquisición" Style="{StaticResource LabelTextStyle}" Margin="0,12,0,8" />
                                <TextBlock Text="{Binding FechaAdquisicion, StringFormat=d}" Style="{StaticResource ValueTextStyle}" Margin="0,0,0,8"/>
                            </StackPanel>
                        </Grid>

                        <TextBlock Text="Observaciones" Style="{StaticResource LabelTextStyle}" Margin="0,8,0,8" />
                        <TextBlock Text="{Binding Observaciones}" Style="{StaticResource ValueTextStyle}" TextWrapping="Wrap" Margin="0,0,0,8"/>

                        <!-- Sección de historial o detalles adicionales -->
                        <ItemsControl ItemsSource="{Binding DetallesAdicionales}" Margin="0,8,0,0">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <VirtualizingStackPanel IsVirtualizing="True" VirtualizationMode="Recycling"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Padding="8" CornerRadius="6" Background="{StaticResource BorderLightBrush}" Margin="0,4,0,4">
                                        <TextBlock Text="{Binding}" TextWrapping="Wrap" Style="{StaticResource ValueTextStyle}"/>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>

                    </StackPanel>
                </ScrollViewer>

                <!-- Footer -->
                <Border Grid.Row="2" Padding="20,12" Background="Transparent">
                    <!-- Margin derecho para dejar separación respecto al borde del card -->
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="0,0,12,0">
                        <Button Content="Cerrar" Click="BtnCerrar_Click" Style="{StaticResource GhostButton}" Margin="0,0,8,0" />
                        <Button Content="Editar" Click="BtnEditar_Click" Style="{StaticResource PrimaryButtonStyle}" Margin="8,0,0,0" Visibility="{Binding CanEditar, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>
    </Grid>
</Window>
