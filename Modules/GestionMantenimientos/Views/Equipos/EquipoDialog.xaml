<Window x:Class="GestLog.Modules.GestionMantenimientos.Views.Equipos.EquipoDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:converters="clr-namespace:GestLog.Converters"
        xmlns:behaviors="clr-namespace:GestLog.Behaviors"
        Title="Equipo" Height="Auto" Width="600" MinHeight="520" MinWidth="520" WindowStartupLocation="CenterOwner"
        ResizeMode="CanResize" WindowStyle="None" AllowsTransparency="True" Background="Transparent" SizeToContent="Manual"
        ShowInTaskbar="False" Loaded="EquipoDialog_Loaded">

    <Window.Resources>
        <!-- Referencia al diccionario estÃ¡ndar de modales -->
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Modules/GestionEquiposInformaticos/Views/Equipos/ModalWindowsStandard.xaml" />
            </ResourceDictionary.MergedDictionaries>
            <converters:DecimalToCopCurrencyConverter x:Key="DecimalToCopCurrencyConverter" />
            <converters:BooleanToErrorStyleConverter x:Key="BooleanToErrorStyleConverter" />
            <converters:EstadoToButtonEnabledConverter x:Key="EstadoToButtonEnabledConverter" />
            <!-- InputStyle compartido (copiado de PerifericoDialog.xaml) -->
            <Style x:Key="InputStyle" TargetType="Control">
                <Setter Property="FontFamily" Value="Segoe UI"/>
                <Setter Property="FontSize" Value="14"/>
                <Setter Property="Padding" Value="12,10"/>
                <Setter Property="Margin" Value="0,0,0,16"/>
                <Setter Property="Height" Value="40"/>
                <Setter Property="BorderBrush" Value="#D0D0D0"/>
                <Setter Property="BorderThickness" Value="1.5"/>
                <Setter Property="Background" Value="#F5F5F5"/>
                <Setter Property="UseLayoutRounding" Value="True"/>
                <Setter Property="SnapsToDevicePixels" Value="True"/>
                <Setter Property="HorizontalAlignment" Value="Stretch"/>
                <Setter Property="VerticalAlignment" Value="Center"/>
                <Style.Triggers>
                    <Trigger Property="IsFocused" Value="True">
                        <Setter Property="BorderBrush" Value="{StaticResource PrimaryBrush}"/>
                        <Setter Property="BorderThickness" Value="2"/>
                        <Setter Property="Background" Value="#FFFFFF"/>
                    </Trigger>
                </Style.Triggers>
            </Style>

            <!-- Estilo para campos requeridos con error -->
            <Style x:Key="RequiredFieldStyle" TargetType="TextBox" BasedOn="{StaticResource InputStyle}">
                <Setter Property="Margin" Value="0,0,0,8"/>
                <Style.Triggers>
                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding ShowValidationErrors}" Value="True"/>
                            <Condition Binding="{Binding IsNombreVacio}" Value="True"/>
                        </MultiDataTrigger.Conditions>
                        <Setter Property="BorderBrush" Value="#E53935"/>
                        <Setter Property="BorderThickness" Value="2"/>
                        <Setter Property="Background" Value="#FFEBEE"/>
                    </MultiDataTrigger>
                </Style.Triggers>
            </Style>
            <!-- Estilo para error en campos -->
            <Style x:Key="ErrorFieldStyle" TargetType="TextBox" BasedOn="{StaticResource RequiredFieldStyle}">
                <Setter Property="BorderBrush" Value="#E53935"/>
                <Setter Property="BorderThickness" Value="2"/>
                <Setter Property="Background" Value="#FFEBEE"/>
            </Style>
            <!-- Estilo para error en ComboBox -->
            <Style x:Key="ErrorComboBoxStyle" TargetType="ComboBox">
                <Setter Property="BorderBrush" Value="#E53935"/>
                <Setter Property="BorderThickness" Value="2"/>
                <Setter Property="Background" Value="#FFEBEE"/>
            </Style>
        </ResourceDictionary>
    </Window.Resources>
    <Grid x:Name="RootGrid" Background="#80000000" MouseLeftButtonDown="Overlay_MouseLeftButtonDown" UseLayoutRounding="True" SnapsToDevicePixels="True">
        <!-- Panel centrado -->
        <Border x:Name="Card" Width="900" MaxHeight="950" Background="{StaticResource SurfaceBrush}" CornerRadius="12" Padding="0"
                HorizontalAlignment="Center" VerticalAlignment="Center" Effect="{StaticResource WindowShadow}" MouseLeftButtonDown="Panel_MouseLeftButtonDown"
                UseLayoutRounding="True" SnapsToDevicePixels="True" RenderOptions.BitmapScalingMode="HighQuality">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!-- Header Modal -->
                <Border Grid.Row="0" Background="{StaticResource PrimaryBrush}" CornerRadius="12,12,0,0" Padding="24,16" Effect="{StaticResource HeaderShadow}" UseLayoutRounding="True" SnapsToDevicePixels="True">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                            <Border Background="White"
                                    CornerRadius="8"
                                    Padding="8"
                                    Margin="0,0,16,0"
                                    Width="44"
                                    Height="44"
                                    Effect="{StaticResource SectionShadow}"
                                    UseLayoutRounding="True"
                                    SnapsToDevicePixels="True">
                                <!-- Icono de equipo: engranaje (U+2699) -->
                                <TextBlock Text="âš™" FontSize="18" Foreground="{StaticResource PrimaryBrush}" HorizontalAlignment="Center" VerticalAlignment="Center" TextAlignment="Center"/>
                            </Border>
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock Text="Datos del Equipo" Style="{StaticResource HeaderTextStyle}" Foreground="White" FontSize="18" FontWeight="Bold"/>
                                <TextBlock Text="InformaciÃ³n detallada" Style="{StaticResource SubHeaderTextStyle}" Foreground="White" Margin="0,4,0,0" FontSize="13" Opacity="0.9"/>
                            </StackPanel>
                        </StackPanel>
                        <Button Grid.Column="1" x:Name="BtnCerrar" Style="{StaticResource CloseButton}" Click="BtnCerrar_Click" ToolTip="Cerrar (Esc)" HorizontalAlignment="Right" VerticalAlignment="Center">
                            <Grid Width="14" Height="14">
                                <Line X1="0" Y1="0" X2="14" Y2="14" Stroke="White" StrokeThickness="2" StrokeStartLineCap="Round" StrokeEndLineCap="Round"/>
                                <Line X1="14" Y1="0" X2="0" Y2="14" Stroke="White" StrokeThickness="2" StrokeStartLineCap="Round" StrokeEndLineCap="Round"/>
                            </Grid>
                        </Button>
                    </Grid>
                </Border>

                <!-- Contenido -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="24" UseLayoutRounding="True" SnapsToDevicePixels="True">
                    <StackPanel UseLayoutRounding="True" SnapsToDevicePixels="True">
                        <!-- SecciÃ³n: InformaciÃ³n BÃ¡sica -->
                        <Border Background="{StaticResource SurfaceBrush}" 
                                CornerRadius="8" 
                                BorderBrush="{StaticResource BorderBrush}" 
                                BorderThickness="1"
                                Effect="{StaticResource CardShadow}"
                                Padding="20">
                            <StackPanel>
                                <TextBlock Text="ðŸ“‹ InformaciÃ³n BÃ¡sica" FontSize="16" FontWeight="Bold" Foreground="#2B5D2A" Margin="0,0,0,16" />
                                
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="16"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    
                                    <!-- Fila 1: CÃ³digo y Nombre -->
                                    <StackPanel Grid.Row="0" Grid.Column="0">
                                        <TextBlock Text="CÃ³digo *" Style="{StaticResource LabelTextStyle}"/>
                                        <TextBox x:Name="CodigoTextBox" 
                                                 Text="{Binding Codigo, UpdateSourceTrigger=PropertyChanged}"
                                                 IsReadOnly="{Binding Path=IsCodigoReadOnly}"
                                                 IsEnabled="{Binding Path=IsCodigoEnabled}"
                                                 Style="{StaticResource InputStyle}"/>
                                        <TextBlock Text="{Binding MensajeCodigoDuplicado}" 
                                                   Foreground="#C0392B" 
                                                   FontSize="11"
                                                   Visibility="{Binding IsCodigoDuplicado, Converter={StaticResource BooleanToVisibilityConverter}}"
                                                   FontWeight="SemiBold" Margin="0,4,0,0"/>
                                    </StackPanel>
                                    
                                    <StackPanel Grid.Row="0" Grid.Column="2">
                                        <TextBlock Text="Nombre *" Style="{StaticResource LabelTextStyle}"/>
                                        <TextBox x:Name="NombreTextBox"
                                                 Text="{Binding Nombre, UpdateSourceTrigger=PropertyChanged}"
                                                 Style="{StaticResource RequiredFieldStyle}"/>
                                    </StackPanel>

                                    <!-- Fila 2: Marca y Estado -->
                                    <StackPanel Grid.Row="1" Grid.Column="0">
                                        <TextBlock Text="Marca" Style="{StaticResource LabelTextStyle}"/>
                                        <ComboBox x:Name="CmbMarca"
                                                  IsEditable="True" IsTextSearchEnabled="False"
                                                  ItemsSource="{Binding MarcasFiltradas}"
                                                  Text="{Binding FiltroMarca, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                  Style="{StaticResource InputStyle}"
                                                  behaviors:ComboBoxEditableUpperBehavior.EnableUppercase="True">
                                            <ComboBox.Resources>
                                                <Style TargetType="TextBox" BasedOn="{StaticResource ComboEditableUpperTextBoxStyle}" />
                                            </ComboBox.Resources>
                                        </ComboBox>
                                    </StackPanel>
                                    
                                    <StackPanel Grid.Row="1" Grid.Column="2">
                                        <TextBlock Text="Estado" Style="{StaticResource LabelTextStyle}"/>
                                        <ComboBox ItemsSource="{Binding EstadosEquipo}"
                                                  SelectedItem="{Binding Estado, UpdateSourceTrigger=PropertyChanged}"
                                                  Style="{StaticResource InputStyle}"/>
                                    </StackPanel>

                                    <!-- Fila 3: Sede (span completo) -->
                                    <StackPanel Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="3">
                                        <TextBlock Text="Sede *" Style="{StaticResource LabelTextStyle}"/>
                                        <ComboBox ItemsSource="{Binding Sedes}"
                                                  SelectedItem="{Binding Sede, UpdateSourceTrigger=PropertyChanged}"
                                                  Style="{StaticResource InputStyle}"/>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </Border>
                        <!-- SecciÃ³n: InformaciÃ³n de Compra -->
                        <Border Background="{StaticResource SurfaceBrush}" 
                                CornerRadius="8" 
                                BorderBrush="{StaticResource BorderBrush}" 
                                BorderThickness="1"
                                Effect="{StaticResource CardShadow}"
                                Padding="20"
                                Margin="0,12,0,0">
                            <StackPanel>
                                <TextBlock Text="ðŸ’° InformaciÃ³n de Compra" FontSize="16" FontWeight="Bold" Foreground="#2B5D2A" Margin="0,0,0,16" />
                                
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="16"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <StackPanel Grid.Column="0">
                                        <TextBlock Text="Fecha de Compra" Style="{StaticResource LabelTextStyle}"/>
                                        <DatePicker x:Name="FechaCompraPicker" 
                                                    SelectedDate="{Binding FechaCompra, UpdateSourceTrigger=PropertyChanged}"
                                                    SelectedDateChanged="OnFechaCompra_SelectedDateChanged"
                                                    Style="{StaticResource InputStyle}"/>
                                    </StackPanel>
                                    
                                    <StackPanel Grid.Column="2">
                                        <TextBlock Text="Precio (COP)" Style="{StaticResource LabelTextStyle}"/>
                                        <TextBox Text="{Binding Precio, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource DecimalToCopCurrencyConverter}}"
                                                 Style="{StaticResource InputStyle}"/>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </Border>
                        <!-- SecciÃ³n: ClasificaciÃ³n y Proveedor -->
                        <Border Background="{StaticResource SurfaceBrush}" 
                                CornerRadius="8" 
                                BorderBrush="{StaticResource BorderBrush}" 
                                BorderThickness="1"
                                Effect="{StaticResource CardShadow}"
                                Padding="20"
                                Margin="0,12,0,0">
                            <StackPanel>
                                <TextBlock Text="ðŸ·ï¸ ClasificaciÃ³n y Proveedor" FontSize="16" FontWeight="Bold" Foreground="#2B5D2A" Margin="0,0,0,16" />
                                
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="16"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <StackPanel Grid.Column="0">
                                        <TextBlock Text="ClasificaciÃ³n" Style="{StaticResource LabelTextStyle}"/>
                                        <ComboBox x:Name="CmbClasificacion"
                                                  IsEditable="True" IsTextSearchEnabled="False"
                                                  ItemsSource="{Binding ClasificacionesFiltradas}"
                                                  Text="{Binding FiltroClasificacion, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                  Style="{StaticResource InputStyle}"
                                                  behaviors:ComboBoxEditableUpperBehavior.EnableUppercase="True">
                                            <ComboBox.Resources>
                                                <Style TargetType="TextBox" BasedOn="{StaticResource ComboEditableUpperTextBoxStyle}" />
                                            </ComboBox.Resources>
                                        </ComboBox>
                                    </StackPanel>
                                    
                                    <StackPanel Grid.Column="2">
                                        <TextBlock Text="Comprado a" Style="{StaticResource LabelTextStyle}"/>
                                        <ComboBox x:Name="CmbCompradoA"
                                                  IsEditable="True" IsTextSearchEnabled="False"
                                                  ItemsSource="{Binding CompradoAFiltrados}"
                                                  Text="{Binding FiltroCompradoA, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                  Style="{StaticResource InputStyle}"
                                                  behaviors:ComboBoxEditableUpperBehavior.EnableUppercase="True">
                                            <ComboBox.Resources>
                                                <Style TargetType="TextBox" BasedOn="{StaticResource ComboEditableUpperTextBoxStyle}" />
                                            </ComboBox.Resources>
                                        </ComboBox>
                                    </StackPanel>
                                </Grid>

                                <!-- Frecuencia Mtto (span completo) -->
                                <StackPanel Margin="0,16,0,0">
                                    <TextBlock Text="Frecuencia de Mantenimiento" Style="{StaticResource LabelTextStyle}"/>
                                    <ComboBox ItemsSource="{Binding FrecuenciasMantenimiento}"
                                              SelectedItem="{Binding FrecuenciaMtto, UpdateSourceTrigger=PropertyChanged}"
                                              Style="{StaticResource InputStyle}"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>
                        <!-- SecciÃ³n: Observaciones -->
                        <Border Background="{StaticResource SurfaceBrush}" 
                                CornerRadius="8" 
                                BorderBrush="{StaticResource BorderBrush}" 
                                BorderThickness="1"
                                Effect="{StaticResource CardShadow}"
                                Padding="20"
                                Margin="0,12,0,0">
                            <StackPanel>
                                <TextBlock Text="ðŸ“ Observaciones" FontSize="16" FontWeight="Bold" Foreground="#2B5D2A" Margin="0,0,0,16" />
                                  <TextBox x:Name="TxtObservaciones" 
                                         Text="{Binding Observaciones, UpdateSourceTrigger=PropertyChanged}"
                                         TextWrapping="Wrap"
                                         AcceptsReturn="True"
                                         Height="70"
                                         VerticalContentAlignment="Top"
                                         VerticalScrollBarVisibility="Auto"
                                         Style="{StaticResource InputStyle}"
                                         Margin="0,0,0,0"
                                         MaxLength="1000"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>

                <!-- Footer Modal -->
                <Border Grid.Row="2" Padding="24,12" Background="Transparent" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,1,0,0">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
                        <Button Content="Cancelar"
                                Style="{StaticResource GhostButton}"
                                Click="OnCancelar_Click"
                                Margin="0,0,8,0"
                                Width="110"
                                Height="40"/>
                        
                        <Button x:Name="BtnGuardar"
                                Content="Guardar"
                                Command="{Binding GuardarCommand}"
                                Click="OnGuardar_Click"
                                IsDefault="True"
                                IsEnabled="{Binding IsFormularioValido}"
                                Style="{StaticResource PrimaryButtonStyle}"
                                Width="110"
                                Height="40"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>
    </Grid>
</Window>



