<Window x:Class="GestLog.Modules.GestionVehiculos.Views.Vehicles.VehicleDocumentDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:GestLog.Modules.GestionVehiculos.ViewModels.Vehicles"
        xmlns:conv="clr-namespace:GestLog.Converters"
        xmlns:controls="clr-namespace:GestLog.Controls"
        Title="Documento de Vehículo"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        SizeToContent="Manual"
        WindowStartupLocation="CenterOwner"
        ShowInTaskbar="False"
        WindowState="Maximized">

    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Resources/ModalWindowsStandard.xaml" />
            </ResourceDictionary.MergedDictionaries>
            <conv:InverseBooleanConverter x:Key="InverseBooleanConverter" />
            <conv:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
            <conv:LoadingIndicatorVisibilityConverter x:Key="LoadingIndicatorVisibilityConverter" />
            <conv:UploadIndeterminateConverter x:Key="UploadIndeterminateConverter" />
        </ResourceDictionary>
    </Window.Resources>

    <!-- OVERLAY MODAL -->
    <Grid x:Name="RootGrid" Background="#80000000" MouseLeftButtonDown="Overlay_MouseLeftButtonDown" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
        <Border x:Name="Card" Width="720" MaxHeight="760"
                Background="{StaticResource SurfaceBrush}"
                CornerRadius="8" Padding="0"
                HorizontalAlignment="Center" VerticalAlignment="Center"
                BorderThickness="1" BorderBrush="{StaticResource BorderBrush}"
                Effect="{StaticResource WindowShadow}" MouseLeftButtonDown="Panel_MouseLeftButtonDown">

            <!-- Contenido de la tarjeta: reutiliza el layout existente -->
            <Grid Margin="12">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <StackPanel Orientation="Vertical" Grid.Row="0" Margin="0,0,0,8">
                    <TextBlock Text="Nuevo documento" FontSize="16" FontWeight="Bold" />
                    <TextBlock Text="Complete los campos y seleccione el archivo." FontSize="12" Foreground="Gray" />
                </StackPanel>

                <Grid Grid.Row="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="1*" />
                        <ColumnDefinition Width="1*" />
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0" Margin="0,0,8,0">
                        <TextBlock Text="Tipo de documento" />
                        <ComboBox ItemsSource="{Binding DocumentTypes}" SelectedItem="{Binding DocumentType}" Style="{StaticResource InputStyle}" />

                        <TextBlock Text="Número" Margin="0,8,0,0" />
                        <TextBox Text="{Binding DocumentNumber}" Style="{StaticResource InputStyle}" />

                        <TextBlock Text="Fecha de emisión" Margin="0,8,0,0" />
                        <DatePicker SelectedDate="{Binding IssuedDate}" />

                        <TextBlock Text="Fecha de vencimiento" Margin="0,8,0,0" />
                        <DatePicker SelectedDate="{Binding ExpirationDate}" />
                    </StackPanel>

                    <StackPanel Grid.Column="1">
                        <TextBlock Text="Notas" />
                        <TextBox Text="{Binding Notes}" AcceptsReturn="True" Height="120" TextWrapping="Wrap" Style="{StaticResource InputStyle}" />

                        <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                            <Button x:Name="BtnSelectFile" Content="Seleccionar archivo..." Click="BtnSelectFile_Click" Style="{StaticResource ButtonStyle}" />
                            <TextBlock Text="{Binding SelectedFileName}" Margin="8,4,0,0" VerticalAlignment="Center" />
                        </StackPanel>

                        <TextBlock Text="Extensiones permitidas: .pdf, .png, .jpg" FontSize="11" Foreground="Gray" Margin="0,6,0,0" />
                        <TextBlock Text="{Binding ErrorMessage}" Foreground="Red" Margin="0,6,0,0" TextWrapping="Wrap" />

                        <!-- Área de progreso y control de subida -->
                        <StackPanel Orientation="Vertical" Margin="0,8,0,0">
                            <controls:SimpleProgressBar Width="Auto" BarHeight="10" ProgressValue="{Binding UploadProgress, Mode=OneWay}" ShowHeader="False" ShowMessage="False" ShowPercentage="True">
                                <controls:SimpleProgressBar.Visibility>
                                    <MultiBinding Converter="{StaticResource LoadingIndicatorVisibilityConverter}">
                                        <Binding Path="IsUploading" />
                                        <Binding Path="UploadProgress" />
                                    </MultiBinding>
                                </controls:SimpleProgressBar.Visibility>
                            </controls:SimpleProgressBar>

                            <ProgressBar Height="8" Minimum="0" Maximum="100" Value="{Binding UploadProgress, Mode=OneWay}" Margin="0,6,0,0">
                                <ProgressBar.IsIndeterminate>
                                    <MultiBinding Converter="{StaticResource UploadIndeterminateConverter}">
                                        <Binding Path="IsUploading" />
                                        <Binding Path="UploadProgress" />
                                    </MultiBinding>
                                </ProgressBar.IsIndeterminate>
                                <ProgressBar.Visibility>
                                    <Binding Path="IsUploading" Converter="{StaticResource BooleanToVisibilityConverter}" />
                                </ProgressBar.Visibility>
                            </ProgressBar>

                            <Button Content="Cancelar subida" Command="{Binding CancelUploadCommand}" Width="120" Margin="0,8,0,0" HorizontalAlignment="Left" Visibility="{Binding IsUploading, Converter={StaticResource BooleanToVisibilityConverter}}" />
                        </StackPanel>

                    </StackPanel>
                </Grid>

                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Grid.Row="2" Margin="0,12,0,0">
                    <Button Content="Cancelar" Width="90" Margin="0,0,8,0" Click="BtnCancel_Click" Style="{StaticResource ButtonStyle}" />
                    <Button x:Name="BtnSave" Content="Guardar" Width="90" IsDefault="True" Click="BtnSave_Click" IsEnabled="{Binding IsUploading, Converter={StaticResource InverseBooleanConverter}}" Style="{StaticResource ButtonStyle}" />
                </StackPanel>

            </Grid>
        </Border>
    </Grid>
</Window>