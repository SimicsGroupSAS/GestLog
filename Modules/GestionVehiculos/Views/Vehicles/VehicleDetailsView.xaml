<UserControl x:Class="GestLog.Modules.GestionVehiculos.Views.Vehicles.VehicleDetailsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:views="clr-namespace:GestLog.Modules.GestionVehiculos.Views.Vehicles"
             mc:Ignorable="d"
             d:DesignWidth="1000" d:DesignHeight="700">
    <UserControl.Resources>
        <!-- Estilos locales para tabs, coherentes con ModalWindowsStandard / EquiposInformaticos -->
        <Style x:Key="DetailTabItemStyle" TargetType="TabItem">
            <Setter Property="TextElement.Foreground" Value="{StaticResource TextPrimaryBrush}"/>
            <Setter Property="Padding" Value="12,8"/>
            <!-- Forzar HeaderTemplate para evitar TextBlock automático que puede recibir UnsetValue en Foreground -->
            <Setter Property="HeaderTemplate">
                <Setter.Value>
                    <DataTemplate>
                        <TextBlock Text="{Binding}" FontSize="13" FontWeight="SemiBold"
                                   Foreground="{Binding RelativeSource={RelativeSource AncestorType=TabItem}, Path=(TextElement.Foreground), FallbackValue={StaticResource TextPrimaryBrush}}"/>
                    </DataTemplate>
                </Setter.Value>
            </Setter>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TabItem">
                        <Grid>
                            <Border x:Name="Bd"
                                    Background="Transparent"
                                    CornerRadius="8,8,0,0"
                                    Padding="8,6"
                                    Margin="0,0,8,0"
                                    BorderBrush="Transparent"
                                    BorderThickness="1">
                                <ContentPresenter ContentSource="Header" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="{StaticResource SurfaceBrush}"/>
                                <Setter TargetName="Bd" Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
                                <Setter Property="TextElement.Foreground" Value="{StaticResource PrimaryBrush}"/>
                                <Setter Property="Panel.ZIndex" Value="10"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="#F3F9F3"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="DetailTabControlStyle" TargetType="TabControl">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TabControl">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <!-- Cabecera de pestañas: fondo blanco con borde, esquinas superiores redondeadas -->
                            <!-- Nota: margen superior interno cambiado a 0 para alinear con la imagen (evita suma doble de márgenes) -->
                            <Border Grid.Row="0" Margin="24,0,24,0" Background="{StaticResource WhiteBrush}" BorderBrush="#E5E5E5" BorderThickness="1" CornerRadius="8,8,0,0" Padding="8,6">
                                <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled" Focusable="False">
                                    <TabPanel IsItemsHost="True" Background="Transparent" />
                                </ScrollViewer>
                            </Border>

                            <!-- Contenido de la pestaña con borde y fondo más contrastado, conectado a la cabecera -->
                            <Border Grid.Row="1" Background="{StaticResource WhiteBrush}" BorderBrush="#E5E5E5" BorderThickness="1" CornerRadius="0,0,8,8" Margin="24,0,24,24" Padding="8">
                                <Border.Effect>
                                    <DropShadowEffect Color="#000000" Opacity="0.04" BlurRadius="8" ShadowDepth="2" RenderingBias="Quality"/>
                                </Border.Effect>
                                <ContentPresenter ContentSource="SelectedContent" Margin="12"/>
                            </Border>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Setter Property="ItemContainerStyle" Value="{StaticResource DetailTabItemStyle}"/>
        </Style>
    </UserControl.Resources>
    <Grid Background="#FAFAFA">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>        <!-- Header con título del vehículo (Marca Modelo Año) -->
        <Border Grid.Row="0" Background="#FFF" BorderBrush="#E5E5E5" BorderThickness="0,0,0,1" Padding="24,16">
            <StackPanel>
                <TextBlock FontSize="28" FontWeight="SemiBold" Foreground="#118938" Margin="0,0,0,8" Text="{Binding VehicleTitle}" />
                <TextBlock FontSize="13" Foreground="#706F6F" Text="{Binding PlateDisplay}" />
            </StackPanel>
        </Border>

        <!-- Contenido principal -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="16" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>            <!-- Panel izquierdo: Foto y datos -->
            <StackPanel Grid.Column="0" Margin="24" VerticalAlignment="Top" Width="320">                <!-- Título pequeño eliminado: se usa el header superior para Brand/Model/Año -->

                <!-- Foto -->
                <Border MaxWidth="320" MaxHeight="256" HorizontalAlignment="Left" Background="#FFF" BorderBrush="#E5E5E5" BorderThickness="1" CornerRadius="8" Padding="8" Margin="0,0,0,12">
                    <Grid Background="#F9F9F9">
                        <Image HorizontalAlignment="Center" VerticalAlignment="Center"
                               Stretch="Uniform" RenderOptions.BitmapScalingMode="HighQuality"
                               SnapsToDevicePixels="True">
                            <Image.Source>
                                <PriorityBinding>
                                    <Binding Path="PhotoPath" />
                                    <Binding Path="PhotoThumbPath" />
                                </PriorityBinding>
                            </Image.Source>
                        </Image>
                    </Grid>
                </Border>                <!-- Datos principales debajo de la foto -->
                <Border Width="320" Background="#FFF" BorderBrush="#E5E5E5" BorderThickness="1" CornerRadius="8" Padding="12" HorizontalAlignment="Left">
                    <StackPanel>
                        <TextBlock Text="Detalles del Vehículo" FontSize="12" FontWeight="SemiBold" Foreground="#706F6F" Margin="0,0,0,8" />

                        <Grid Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="110" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Placa:" FontSize="11" FontWeight="SemiBold" Foreground="#504F4E" />
                            <TextBlock Grid.Column="1" Text="{Binding Plate}" FontSize="11" Foreground="#1D1D1B" />
                        </Grid>

                        <Grid Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="110" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="VIN:" FontSize="11" FontWeight="SemiBold" Foreground="#504F4E" />
                            <TextBlock Grid.Column="1" Text="{Binding Vin}" FontSize="11" Foreground="#1D1D1B" TextWrapping="Wrap" />
                        </Grid>

                        <Grid Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="110" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Color:" FontSize="11" FontWeight="SemiBold" Foreground="#504F4E" />
                            <TextBlock Grid.Column="1" Text="{Binding Color}" FontSize="11" Foreground="#1D1D1B" />
                        </Grid>

                        <Grid Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="110" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Tipo:" FontSize="11" FontWeight="SemiBold" Foreground="#504F4E" />
                            <TextBlock Grid.Column="1" Text="{Binding Type}" FontSize="11" Foreground="#1D1D1B" />
                        </Grid>

                        <Grid Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="110" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Kilometraje:" FontSize="11" FontWeight="SemiBold" Foreground="#504F4E" />
                            <TextBlock Grid.Column="1" Text="{Binding Mileage, StringFormat='{}{0:N0} km'}" FontSize="11" Foreground="#1D1D1B" />
                        </Grid>

                        <Grid Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="110" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Estado:" FontSize="11" FontWeight="SemiBold" Foreground="#504F4E" />
                            <TextBlock Grid.Column="1" Text="{Binding State}" FontSize="11" Foreground="#1D1D1B" />
                        </Grid>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="110" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Combustible:" FontSize="11" FontWeight="SemiBold" Foreground="#504F4E" />
                            <TextBlock Grid.Column="1" Text="{Binding FuelType, TargetNullValue='No especificado'}" FontSize="11" Foreground="#1D1D1B" />
                        </Grid>
                    </StackPanel>
                </Border>
            </StackPanel>            <!-- Pestañas en la derecha -->
            <TabControl Grid.Column="2" Margin="0,24,24,24" Style="{StaticResource DetailTabControlStyle}">
                <TabItem Header="General">
                    <ScrollViewer>
                        <StackPanel Margin="16">
                            <TextBlock Text="Indicadores (KPIs)" FontSize="16" FontWeight="SemiBold" Foreground="#504F4E" Margin="0,0,0,12" />

                            <!-- Cuadrícula de tarjetas de KPI -->
                            <UniformGrid Columns="2" Rows="2" Margin="-6,0,0,12">
                                <Border Background="#FFF" BorderBrush="#E5E5E5" BorderThickness="1" CornerRadius="8" Padding="12" Margin="6">
                                    <StackPanel>
                                        <TextBlock Text="Consumo promedio" FontSize="12" Foreground="#706F6F" />
                                        <TextBlock Text="{Binding AverageConsumption, StringFormat='{}{0:N1} L/100km'}" FontSize="20" FontWeight="Bold" Foreground="#118938" Margin="0,8,0,0" />
                                    </StackPanel>
                                </Border>

                                <Border Background="#FFF" BorderBrush="#E5E5E5" BorderThickness="1" CornerRadius="8" Padding="12" Margin="6">
                                    <StackPanel>
                                        <TextBlock Text="Kilometraje mensual" FontSize="12" Foreground="#706F6F" />
                                        <TextBlock Text="{Binding MonthlyMileage, StringFormat='{}{0:N0} km'}" FontSize="20" FontWeight="Bold" Foreground="#118938" Margin="0,8,0,0" />
                                    </StackPanel>
                                </Border>

                                <Border Background="#FFF" BorderBrush="#E5E5E5" BorderThickness="1" CornerRadius="8" Padding="12" Margin="6">
                                    <StackPanel>
                                        <TextBlock Text="Costo mantenimiento (acum.)" FontSize="12" Foreground="#706F6F" />
                                        <TextBlock Text="{Binding MaintenanceCost, StringFormat='{}{0:C}'}" FontSize="20" FontWeight="Bold" Foreground="#118938" Margin="0,8,0,0" />
                                    </StackPanel>
                                </Border>

                                <Border Background="#FFF" BorderBrush="#E5E5E5" BorderThickness="1" CornerRadius="8" Padding="12" Margin="6">
                                    <StackPanel>
                                        <TextBlock Text="Último / Próximo servicio" FontSize="12" Foreground="#706F6F" />
                                        <TextBlock Text="{Binding LastServiceDate, StringFormat='Último: {0:dd/MM/yyyy}'}" FontSize="13" Foreground="#1D1D1B" Margin="0,6,0,0" />
                                        <TextBlock Text="{Binding NextServiceDate, StringFormat='Próximo: {0:dd/MM/yyyy}'}" FontSize="13" Foreground="#706F6F" />
                                    </StackPanel>
                                </Border>
                            </UniformGrid>

                            <!-- Sección de rendimiento y uso -->
                            <TextBlock Text="Rendimiento y uso" FontSize="14" FontWeight="SemiBold" Foreground="#504F4E" Margin="0,8,0,8" />
                            <Grid Margin="0,0,0,12">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0" Margin="0,0,12,0">
                                    <TextBlock Text="Total viajes" FontSize="12" Foreground="#706F6F" />
                                    <TextBlock Text="{Binding TotalTrips}" FontSize="14" FontWeight="Bold" Foreground="#1D1D1B" Margin="0,6,0,8" />

                                    <TextBlock Text="Velocidad promedio" FontSize="12" Foreground="#706F6F" />
                                    <TextBlock Text="{Binding AverageSpeed, StringFormat='{}{0:N1} km/h'}" FontSize="14" FontWeight="Bold" Foreground="#1D1D1B" Margin="0,6,0,0" />
                                </StackPanel>

                                <StackPanel Grid.Column="1">
                                    <TextBlock Text="Horas motor" FontSize="12" Foreground="#706F6F" />
                                    <TextBlock Text="{Binding EngineHours, StringFormat='{}{0:N0} h'}" FontSize="14" FontWeight="Bold" Foreground="#1D1D1B" Margin="0,6,0,8" />

                                    <TextBlock Text="Combustible usado" FontSize="12" Foreground="#706F6F" />
                                    <TextBlock Text="{Binding FuelConsumed, StringFormat='{}{0:N1} L'}" FontSize="14" FontWeight="Bold" Foreground="#1D1D1B" Margin="0,6,0,0" />
                                </StackPanel>
                            </Grid>

                            <!-- Notas o resumen breve -->
                            <TextBlock Text="Resumen" FontSize="14" FontWeight="SemiBold" Foreground="#504F4E" Margin="0,8,0,8" />
                            <TextBlock Text="{Binding GeneralNotes}" TextWrapping="Wrap" Foreground="#1D1D1B" />
                        </StackPanel>
                    </ScrollViewer>
                </TabItem>

                <TabItem Header="Documentos">
                    <!-- Insertar la vista de documentos como UserControl para mantener separación MVVM -->
                    <views:VehicleDocumentsView x:Name="DocumentsView" />
                </TabItem>

                <TabItem Header="Mantenimientos">
                    <ScrollViewer>
                        <StackPanel Margin="16">
                            <TextBlock Text="Historial de Mantenimientos" FontSize="14" FontWeight="SemiBold" Foreground="#504F4E" Margin="0,0,0,12" />
                            <TextBlock Text="Mantenimientos realizados y próximos servicios" Foreground="#706F6F" />
                            <!-- Placeholder: implementar lista real más adelante -->
                        </StackPanel>
                    </ScrollViewer>
                </TabItem>

                <TabItem Header="Historial">
                    <ScrollViewer>
                        <StackPanel Margin="16">
                            <TextBlock Text="Historial Operativo" FontSize="14" FontWeight="SemiBold" Foreground="#504F4E" Margin="0,0,0,12" />
                            <TextBlock Text="Accidentes, infracciones y cambios del vehículo" Foreground="#706F6F" />
                            <!-- Placeholder: implementar lista real más adelante -->
                        </StackPanel>
                    </ScrollViewer>
                </TabItem>
            </TabControl>
        </Grid>
    </Grid>
</UserControl>
